<!DOCTYPE html>
<html>
<head>
	<title>Honeycomb Profiler</title>
  <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>    
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

</head>

<body>
	
</body>

<script>
 $(document).ready(function(){

    var hash;
    var code;
    var binary = "";
    var choice = 9; 
    var redMeat = 0; var whiteMeat = 0; var pork = 0; 
    var fish = 0; var otherSeafood = 0; var tofu = 0;
    var peanuts = 0; var treenuts = 0; var dairy = 0;
    var cheese = 0; var eggs = 0; var wheat = 0;
    var gluten = 0; var soy = 0; var sesameseeds = 0;
    var fruit = 0; var shellfish = 0; var corn = 0; 
    var someThingElse = 0; var spicy = 0; var mushrooms = 0; 
    var onions = 0; var dessert = 0;

    //PUSH USERSTRING TO FIREBASE USING USERAUTH
        var ref = new Firebase("https://honeycombapp.firebaseio.com/");
        var url = String(window.location.href);
        hash = url.substring(url.indexOf('?')+1);
        var username = hash.split(':')[0];
        code = hash.substring(hash.indexOf(':')+1);

        if(code.length <= 1){
        binary = binary + String(choice) + String(redMeat) + String(whiteMeat) + String(pork)  + String(fish) + String(otherSeafood) + String(tofu) + String(peanuts) + String(treenuts) + String(dairy) + String(cheese) + String(eggs) + String(wheat) + String(gluten) + String(soy) + String(sesameseeds) + String(fruit) + String(shellfish) + String(corn) + String(someThingElse) + String(spicy) + String(mushrooms) + String(onions) + String(dessert);        	
        }

        
        else{


        console.log(code);

        if(parseInt(code[0]) == 1) redMeat = 1;

        else if(parseInt(code[0]) == 2) whiteMeat = 1;

        else if(parseInt(code[0]) == 4) pork = 1;

        else if (parseInt(code[0]) == 3){
            redMeat = 1;
            whiteMeat = 1;
        }

        else if (parseInt(code[0]) == 5){
            redMeat = 1;
            pork = 1;
        }

        else if (parseInt(code[0]) == 6){
            whiteMeat = 1;
            pork = 1;
        }

        else if (parseInt(code[0]) == 7){
            whiteMeat = 1;
            pork = 1;
            redMeat = 1;
        }


        if (parseInt(code[1])% 2 != 0) {
        	fish = 1;
        }

        if (parseInt(code[1]) == 2 || parseInt(code[1]) == 3 || parseInt(code[1]) == 6 || parseInt(code[1])== 7){
        	otherSeafood = 1;
        }

        if (parseInt(code[1]) == 4 || parseInt(code[1]) == 5 || parseInt(code[1]) == 6 || parseInt(code[1])== 7){
        	tofu = 1;
        }

        if (parseInt(code[2])% 2 != 0) {
        	peanuts = 1;
        }

        if (parseInt(code[2]) == 2 || parseInt(code[2]) == 3 || parseInt(code[2]) == 6 || parseInt(code[2])== 7){
        	treenuts = 1;
        }

        if (parseInt(code[2]) == 4 || parseInt(code[2]) == 5 || parseInt(code[2]) == 6 || parseInt(code[2])== 7){
        	dairy = 1;
        }

        if (parseInt(code[3])% 2 != 0) {
        	cheese = 1;
        }

        if (parseInt(code[3]) == 2 || parseInt(code[3]) == 3 || parseInt(code[3]) == 6 || parseInt(code[3])== 7){
        	eggs = 1;
        }

        if (parseInt(code[3]) == 4 || parseInt(code[3]) == 5 || parseInt(code[3]) == 6 || parseInt(code[3])== 7){
        	wheat = 1;
        }
        if (parseInt(code[4])% 2 != 0) {
        	gluten = 1;
        }

        if (parseInt(code[4]) == 2 || parseInt(code[4]) == 3 || parseInt(code[4]) == 6 || parseInt(code[4])== 7){
        	soy = 1;
        }

        if (parseInt(code[4]) == 4 || parseInt(code[4]) == 5 || parseInt(code[4]) == 6 || parseInt(code[4])== 7){
        	sesameseeds = 1;
        }

        if (parseInt(code[5])% 2 != 0) {
        	fruit = 1;
        }

        if (parseInt(code[5]) == 2 || parseInt(code[5]) == 3 || parseInt(code[5]) == 6 || parseInt(code[5])== 7){
        	corn = 1;
        }

        if (parseInt(code[5]) == 4 || parseInt(code[5]) == 5 || parseInt(code[5]) == 6 || parseInt(code[5])== 7){
        	shellfish = 1;
        }

        if (parseInt(code[6])% 2 != 0) {
        	spicy = 1;
        }

        if (parseInt(code[6]) == 2 || parseInt(code[6]) == 3 || parseInt(code[6]) == 6 || parseInt(code[6])== 7){
        	mushrooms = 1;
        }

        if (parseInt(code[6]) == 4 || parseInt(code[6]) == 5 || parseInt(code[6]) == 6 || parseInt(code[6])== 7){
        	onions = 1;
        }

        binary = binary + String(choice) + String(redMeat) + String(whiteMeat) + String(pork)  + String(fish) + String(otherSeafood) + String(tofu) + String(peanuts) + String(treenuts) + String(dairy) + String(cheese) + String(eggs) + String(wheat) + String(gluten) + String(soy) + String(sesameseeds) + String(fruit) + String(shellfish) + String(corn) + String(someThingElse) + String(spicy) + String(mushrooms) + String(onions) + String(dessert);


        console.log(binary);

        }


        var onComplete = function (error) {
            if (error){
            }
            else{
                window.alert("I am currently changing the code to make matches more accurate :) Feel free to mess around but you might get incorrect matches. Try tomorrow!");
                window.location.href= "../restaurant.html?" + username;
            }
        }

        var usersRef = ref.child("users");
        usersRef.child(String(username)).set({
          binary: binary
        }, onComplete);
        

  });

</script>

</html>